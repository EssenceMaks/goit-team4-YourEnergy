{"version":3,"file":"favorites-CMdbTHaM.js","sources":["../../src/js/favorites.js"],"sourcesContent":["import axios from 'axios';\nimport { exerciseInfoRequest, exerciseUrl } from './api-service';\nimport createWorkoutsMarkup from './markup/workoutsMarkup';\nimport { generatePages } from './pagination';\nimport { ModalWindow } from './modal-window';\n\nconst currentPath = window.location.pathname;\n\nlet imageFavorites = document.querySelector('.fav-picture');\nif (imageFavorites) {\n  imageFavorites.outerHTML = `\n    <picture>\n      <source\n        media=\"(min-width: 1440px)\"\n        srcset=\"\n          ./img/sidebar/favorites/favorites-des-1x.jpg 1x,\n          ./img/sidebar/favorites/favorites-des-2x.jpg 2x\n        \"\n      />\n      <source\n        media=\"(min-width: 768px)\"\n        srcset=\" \n          ./img/sidebar/favorites/favorites-tab-1x.jpg 1x,\n          ./img/sidebar/favorites/favorites-tab-2x.jpg 2x\n        \"\n      />\n      <img\n        class=\"sidebar-quote-image\"\n        srcset=\" \n          ./img/sidebar/favorites/favorites-mob-1x.jpg 1x,\n          ./img/sidebar/favorites/favorites-mob-2x.jpg 2x\n        \"\n        src=\"./img/sidebar/favorites/favorites-mob-1x.jpg\"\n        alt=\"sidebar-container\"\n        loading=\"lazy\"\n      />\n    </picture>\n  `;\n}\n\nconst menuItems = document.querySelectorAll('.menu-item');\n\nif (currentPath.includes('favorites.html')) {\n  menuItems.forEach(item => item.classList.remove('active'));\n  menuItems[1].classList.add('active');\n}\n\nconst favoritesText = document.querySelector('.favorites-page-text');\nconst favoritesCards = document.querySelector('.favorites-cards');\nconst categoriesPagination = document.querySelector('.favorites-pagination');\n\nlet getFavorites = JSON.parse(localStorage.getItem('favorites')) || [];\nlet dataList = [];\nlet currentPage = 0;\n\nconst fetchAndRenderFavorites = async () => {\n  if (!getFavorites || getFavorites.length === 0) {\n    favoritesText.style.display = 'block';\n    favoritesCards.innerHTML = '';\n    return;\n  }\n\n  try {\n    dataList = [];\n    for (const exercise of getFavorites) {\n      const { data } = await axios.get(exerciseInfoRequest(exercise.id));\n      dataList.push(data);\n    }\n\n    let workoutMarkup;\n    let itemsPerPage;\n\n    const screenWidth = window.innerWidth;\n\n    if (screenWidth <= 768) {\n      itemsPerPage = 8;\n    } else if (screenWidth <= 1440) {\n      itemsPerPage = 10;\n    } else {\n      itemsPerPage = dataList.length;\n    }\n\n    const totalPages = Math.ceil(dataList.length / itemsPerPage);\n    categoriesPagination.setAttribute('data-total', totalPages);\n\n    if (totalPages <= 1) {\n      categoriesPagination.style.display = 'none';\n    } else {\n      categoriesPagination.style.display = 'flex';\n    }\n\n    if (screenWidth > 1440) {\n      workoutMarkup = createWorkoutsMarkup(dataList);\n      favoritesText.style.display = 'none';\n      favoritesCards.innerHTML = workoutMarkup;\n      changeTrash();\n      categoriesPagination.innerHTML = '';\n    } else {\n      workoutMarkup = createWorkoutsMarkup(\n        dataList.slice(\n          currentPage * itemsPerPage,\n          (currentPage + 1) * itemsPerPage\n        )\n      );\n      favoritesText.style.display = 'none';\n      favoritesCards.innerHTML = workoutMarkup;\n\n      if (categoriesPagination) {\n        categoriesPagination.innerHTML = '';\n        const paginationElement = generatePages(totalPages, currentPage);\n        categoriesPagination.appendChild(paginationElement);\n\n        categoriesPagination\n          .querySelectorAll('.pagination-page')\n          .forEach(btn => {\n            btn.addEventListener('click', handlePagination);\n          });\n      }\n    }\n\n    const startButtons = document.querySelectorAll('.workout-start-btn');\n    startButtons.forEach(button => {\n      button.addEventListener('click', async e => {\n        e.preventDefault();\n        const workoutCard = button.closest('.workouts-card');\n        const exerciseId = workoutCard.dataset.id;\n\n        try {\n          const response = await fetch(`${exerciseUrl()}/${exerciseId}`);\n          if (!response.ok) throw new Error('Failed to fetch exercise details');\n\n          const exerciseData = await response.json();\n\n          if (!window.modalWindow) {\n            window.modalWindow = new ModalWindow();\n          }\n          window.modalWindow.open(exerciseData);\n\n\n          // --------------якщо відкрили модалку, видалили картку, оновити це в розмітці---------\n\n          // const closeBTtn = document.querySelector('.modal-close-btn');\n          // closeBTtn.addEventListener('click', () => {\n          //   const newFavorites =\n          //     JSON.parse(localStorage.getItem('favorites')) || [];\n          //   if (JSON.stringify(getFavorites) !== JSON.stringify(newFavorites)) {\n          //     getFavorites = newFavorites;\n          //     fetchAndRenderFavorites();\n          //   }\n          // })\n\n\n        } catch (error) {\n          console.error('Error opening modal:', error);\n        }\n      });\n    });\n\n    \n  } catch (error) {\n    console.error(error);\n  }\n};\n\nfunction deleteFromFavorites(e) {\n  const workoutCard = e.target.closest('.workouts-card');\n  const workoutId = workoutCard.getAttribute('data-id');\n\n  getFavorites = getFavorites.filter(fav => fav.id !== workoutId);\n  localStorage.setItem('favorites', JSON.stringify(getFavorites));\n\n  if (!getFavorites || getFavorites.length === 0) {\n    favoritesText.style.display = 'block';\n    favoritesCards.innerHTML = '';\n  } else {\n    const totalPages = Math.ceil(getFavorites.length / 8);\n    if (currentPage >= totalPages) {\n      currentPage = totalPages - 1;\n    }\n\n    fetchAndRenderFavorites();\n  }\n}\n\nfunction handlePagination(e) {\n  const page = Number(e.target.dataset.index);\n  currentPage = page;\n  categoriesPagination.setAttribute('data-current', currentPage);\n  let pages = categoriesPagination.querySelectorAll('p');\n  pages.forEach(pag => {\n    pag.classList.remove('selected');\n  });\n  e.target.classList.add('selected');\n\n  const screenWidth = window.innerWidth;\n  let itemsPerPage;\n\n  if (screenWidth <= 768) {\n    itemsPerPage = 8;\n  } else if (screenWidth <= 1440) {\n    itemsPerPage = 10;\n  } else {\n    return;\n  }\n\n  const startIndex = page * itemsPerPage;\n  const endIndex = startIndex + itemsPerPage;\n\n  const pageItems = dataList.slice(startIndex, endIndex);\n\n  favoritesCards.innerHTML = createWorkoutsMarkup(pageItems);\n  changeTrash();\n}\n\nfunction changeTrash() {\n  const ratingContainers = document.querySelectorAll('.rating-container');\n  ratingContainers.forEach(rating => rating.classList.add('hide'));\n\n  const trashContainers = document.querySelectorAll('.trash-container');\n  trashContainers.forEach(trash => {\n    trash.classList.remove('hide');\n    trash.addEventListener('click', deleteFromFavorites);\n  });\n}\n\nfetchAndRenderFavorites();\n"],"names":["currentPath","imageFavorites","menuItems","item","favoritesText","favoritesCards","categoriesPagination","getFavorites","dataList","currentPage","fetchAndRenderFavorites","exercise","data","axios","exerciseInfoRequest","workoutMarkup","itemsPerPage","screenWidth","totalPages","createWorkoutsMarkup","changeTrash","paginationElement","generatePages","btn","handlePagination","button","e","exerciseId","response","exerciseUrl","exerciseData","ModalWindow","error","deleteFromFavorites","workoutId","fav","page","pag","startIndex","endIndex","pageItems","rating","trash"],"mappings":"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"}